---
name: issue-plan
description: Research and create an implementation plan through collaborative workflow, then comment on the issue
allowed-tools: Bash(gh issue view:*), Bash(gh label list), Bash(gh issue comment:*)
argument-hint: <issue-number>
---

## Pre-loaded Context

`!gh issue view $ARGUMENTS && echo -e "\n========== COMMENTS ==========\n" && gh issue view $ARGUMENTS --comments`

`!gh label list`

I need you to research and plan the implementation for issue #$ARGUMENTS using a collaborative workflow.

## Arguments:

If $ARGUMENTS is empty, prompt user for issue number

## Collaborative Planning Workflow

This command uses a three-phase collaborative approach to ensure the plan aligns with user expectations.

### Phase 1: Initial Summary & Questions

1. **Fetch issue:** `gh issue view {number}`

2. **Fetch comments:**
   - If comments are present in the metadata: `gh issue view {number} --comments`
   - Skip this step if metadata contains `comments: 0` or `--no-comments` flag

3. **Research relevant codebase files and patterns**

4. **Draft initial plan summary** to `docs/sandbox/issue-{number}-plan-summary.md`:
   - Brief approach summary (2-4 paragraphs)
   - Key implementation decisions
   - Files/patterns to use
   - **`## Questions for User` section** with:
     - Clarifying questions from research
     - Alternative approach options
     - Any ambiguities that need resolution

5. **Present summary and ask user for improvements**

### Phase 2: Refined Summary (Iterative)

6. **User answers questions and/or requests changes**

7. **Update summary** in `docs/sandbox/issue-{number}-plan-summary.md`:
   - Incorporate user feedback
   - Update approach based on answers
   - Add follow-up questions if needed

8. **Iterate** until user gives final approval of summary
   - User can request changes at any point
   - Claude can ask additional questions as needed

### Phase 3: Detailed Plan

9. **Draft detailed plan** to `docs/sandbox/issue-{number}-plan.md`:
   - `ðŸ¤– Generated by Claude Code` header
   - Written in **third person** (comment style)
   - Detailed implementation steps
   - File references and code patterns
   - Considerations and trade-offs
   - **Remove** the Questions section (no longer needed)

10. **User approves or requests changes**
    - User can edit the file directly or request Claude make changes
    - Iterate until final approval

11. **Provide command to post:**

```bash
gh issue comment {number} -F docs/sandbox/issue-{number}-plan.md
```

## File Organization

- **Summary file:** `docs/sandbox/issue-{number}-plan-summary.md` (working draft, stays in sandbox)
- **Final plan:** `docs/sandbox/issue-{number}-plan.md` (posted to GitHub)

## Writing Style

- **Summary:** Conversational, exploratory, includes questions
- **Final plan:** Professional third-person, actionable steps, comprehensive

## Notes

- The Questions for User section is a collaboration tool - it gets removed from the final plan
- User has approval gates at both summary and detailed plan stages
- Iteration is expected and encouraged at both phases
- Wait for user approval before posting to GitHub
