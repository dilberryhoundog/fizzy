# Dev Workspace

## What is it?

This is a developer workspace system for use with Claude Code. The premise is simple... Store and manage context generated by and used for Claude AI while working on a codebase.

This workspace system is not intended to replace any of your existing workflows and allows for integration of any new workflows you may want to create or try yourself. This system doesn't touch: CLAUDE.md, agents, skills or mcp servers, you are free to use these tools as you wish.

Dev Workspace has a strong suite of version control tools, namespaced custom commands and a Hook system that provides expert level control over your context.

## About me

The creator of this system has been using Claude since sonnet 3.5 (before mcp), having not touched any other AI tools. Using the pro account all this time (finally got a 5x max plan this month), I learnt expert management of "prompt, context and tokens" over the time, only having a chat box teaches you this. Claude Code was a great upgrade because it allowed direct access to the codebase and command line, but has become very complicated (but powerful) since. 
So this system is to pay homage to the chat box, focusing on prompt and context, but also an attempt to tame the beast.

## Key Features

### Git Management

For each new feature or fix you attempt, create a git branch. A prebuilt command does this for you. 
A fresh copy of the workspace directory is pulled into your feature branch from main. Then as you work this directory fills up with all kinds of context, specific to the feature, task or fix. 

As you go you commit all changes to the feature branch. Once complete Claude checks a specific WORKSPACE.md configuration file to know exactly how to merge your branch and what to do with all your workspace context. Your branch is then automatically prepared, safely checked then merged back to main. 

However, the workspace directory is prevented from being committed to the main branch. This means no feature branch ever overwrites the main branch's workspace template. This enables a fresh copy of the workspace template for each branch created.

But what happened to all that precious context we just built up? Well if using the default setting, it will be archived in the `dev/branches` directory. This directory IS committed to main, so allows you to refer back to at any time.

What this means is for each feature or fix you do, a complete history of all your plans, tasks, conversations, reviews, scratch-files, etc is archived and is referable at anytime during the build of your project.

### Directory System

Workspace is a two part system in your project directory. We have some Claude Code tools and files in the .claude directory, But our main focus in this section is `dev/workspace`, this is where all the context files for the branch is stored. These are the directories and files...

- **context/** - place for command generated discovery context, tree views etc. Gives claude vision over your codebase so he doesn't have to go digging all the time.
- **filebox/** - place for all your scratch files, a file dump location. So important when claude is pumping out all kinds of random stuff.
- **history/** - All your conversations with claude, neatly presented, summarised and named.
- **plans/** - All the plans you create with claude can go in here. Has prebuilt product and architecture templates, to build out. but can store all your own.
- **prompts/** - Copy and pasting prompts into chat has never stopped being useful. I build prompts in txt files before pasting, takes the pressure off and allows for more fidelity in the prompt. Comes with some prebuilt templates for highly structured discovery and research. Also has some xml i was experimenting with (opus is good enough now to not really need these).
- **research/** - Comes empty but allow for the structured research command to have an output location, can also be used for any other adhoc research you bring to the table.
- **reviews/** - Also empty, but a few of the workspace's commands will end up with some reviews in there.
- **tasks/** - For both claude and you to create referenceable tasks lists. Often coming from the end of your planning workflow. allowing you to track work over many sessions.
- **CLAUDE.md** - Comes preconfigured with useful context regarding the workspace system. Is designed to be shown to claude, when the session starts. Has a section to quickly place useful discoveries applicable to the branch (extract out to project level CLAUDE.md later).
- **WORKSPACE.md** - Has some preconfigured markdown checkboxes that guides Claude when managing the workspace. Designed to be shown to Claude when the session starts.

### Slash Commands

A comprehensive suite of commands to automate the management and context gathering of the branches workspace.

- **/new-workspace** - Creates the new branch after some safety checks. Sets up the workspace directory.
- **/archive-workspace** - Safely archives all the context in the workspace directory with a named directory in branches folder. Can be re-run to update the archive.
- **/merge-preflight** - Validates the readiness for the branch to be merged and workspace archived, produces a report for the user to complete any fixes.
- **/merge-branch** - Safely merges the branch into main using a pull request and performs any cleanup tasks / recommendations.
- **/discover** - Does a deep dive into the codebase in response to the user uploading the discover prompt template or written manually. Uses the built in 'Explore' agent. Outputs a comprehensive discover report.
- **/research** - Does a similar deep dive as discover but uses 'general-purpose' agent to research external web context. Uses the research template prompt or manual instructions. Outputs a research report. Has a second version, not sure which one I prefer yet.
- **/context-files** - Builds a file list for easy guiding of claude based upon any discovery or plans created in workspace.
- **/rename-history** - Renames a chat transcript if the file was not autonamed by the session_end hook.
- **/prune-history** - Suggests redundant chat transcripts to remove from history if lots of small logistics based chats have been recorded.
- **/tree** - Backup command to run the tree tool. hard coded directory paths, change as required. builds a full view of the codebase directory paths entered and outputs a tree file.

### Hooks

A suite of premium hooks leveraging an excellent ruby library called "claude_hooks". The library does all the background work of managing hooks with claude code. It uses a single point of entry for each hook event, intelligently combines multiple hooks and outputs all the correct codes and json for claude to respond to.

On top of this library, workspace uses three awesome hook based tools to manage and deliver context to claude. They are each explained in detail further along but here is a basic introduction.

- **session_start** - Runs the tree tool to build up to date, directory and file context for claude. Injects workspace context (including tree) into the session before conversation or coding begins.
- **session_end** - Extracts the session transcript from the .claude folder and saves it to the history folder. Also renames and summarises the transcript using a headless claude session.
- **user_prompt_submit** - Runs a suite of word based triggers that manipulate Claude's output allow for advanced context building in the session.

These hooks are all written in ruby, if you don't want to use ruby claude may be able to help you build these hooks in python / typescript etc but you will lose access to the awesome "claude_hooks" library. meaning they may not work quite as well.

The claude_hooks library also produces a customisable log record for each session, allowing for advance diagnostics and checking of each hook event. These are captured in the users (global) .claude directory.

A config file is available for 'claude_hooks' to allow customisation of some hook parameters, like; what directories the tree command searches, or the files to use for preloaded context.

### Conversation Capture

This is a premium context capture tool. Every conversation you have with claude can be parsed and recorded. Allowing you to re-read, include in other sessions or iterate over for patterns.
The session_end hook captures this using some special functionality...

- Every historical conversation capture file is built using template files. These are all configurable with both the plain text formatting and the erb (ruby-based interpolation) code. These templates produce a rich and readable history file, with greatly reduced token load. So they are quite efficient to use as a context source.
- Relies upon the inbuilt `/exit` or `/clear` commands to trigger the hook. Capturing meaningless or logistics chats can be prevented by just closing the chat window. If you need to capture a chat that was closed accidentally, just use `/resume` to reload it.
- Filters out useless transcripts that claude code produces so that only the key discussions are captured.
- Waits to exit the chat until the hook finishes or happens in the background when clearing the chat.
- A headless session is created when exiting or clearing that analyses the transcript and renames and summarises the file after the hook creates the file.

This results in some really great conversation history files, featuring...

- The transcript file metadata so that the history file can be intelligently updated if the hook fires a second time.
- Rich content signalling; when new conversation branching arise (when the user resumes or rewinds a conversation), The thinking level that was used for a user turn, who's turn in the conversation, slash commands the user used.
- Captures all the read, write, edit, bash, agent and skill tool usages, recording the specific tool used and the file or command utilised, but leaves out the file or command contents. This is a huge token saver but preserves the flow allowing understanding of what happened with these files and commands.
- The headless call produces an excellent contextual file name with date prefix so that you can easily get an overview without opening the file. It also produces a summary so that claude can contextually search history files for specific topics.

A great workflow I have using this feature, is...
Open up a conversation with claude, chat about the changes I want to make, have claude search and discover naturally, then when finished exit the conversation. 
Then I start a new conversation, load the captured transcript and get to work with advanced, token-saving, naturally built chat context.

Here is an extract of a history file.

```txt
Session: f34c642d-3573-4bf1-9af0-e1e431df9aba
Date: 2025-12-03 18:18
Branch: docs/extract-rails-patterns
CWD: ~/Projects/37signals/fizzy

============================================================
[SUMMARY]
>>>
Explored Fizzy's layout system and content injection patterns. Discovered minimal shell layout with named yield slots and instance variable configuration, CSS-driven container widths via `.panel` classes and `:has()` selectors, and zero-JS user-scoped CSS. Extracted findings into layout-shell.md pattern documentation.
<<<
------------------------------------------------------------
[âœ¨ NEW CONVERSATION BRANCH]
[USER]    ðŸ’­: none
as per our @CLAUDE.md, lets discuss how fizzy uses application.html and subsequent patterns to inject content and partials, particularly interesting is "content_for" on most view pages.

------------------------------------------------------------

[ASSISTANT]
Great topic! Let me explore how Fizzy uses `content_for` and the layout patterns.

------------------------------------------------------------

[READ TOOL]
File: ~/Projects/37signals/fizzy/app/views/layouts/application.html.erb

------------------------------------------------------------

[ASSISTANT]
Interesting patterns emerging. Let me look at the shared head partial and a few representative views to see the full picture:

------------------------------------------------------------

[READ TOOL]
File: ~/Projects/37signals/fizzy/app/views/layouts/shared/_head.html.erb

------------------------------------------------------------
```

### Session Context Injection

Context injection when the session starts, is a powerful tool, enabled by the session_start hook. Claude silently receives (not shown to the user) very relevant and helpful context from the workspace before coding or conversation begins.
This hook uses some advanced functionality to deliver context to claude...

- Creates a tree.md file that shows the project's directories (based on config.json) and files in a tree structure. This is the most token-efficient way to show claude all the relevant files and folders in your project.
- Stitches together configurable (multiple) context sources with start, end and separator formatting. This context is then shown silently to claude when the session starts.
- Logs the injected context in the (global) .claude directory for reference purposes if you need to check what claude is actually seeing.

This produces premium usable context before the session begins...

- `tree.md` allows claude to instantly jump to any file or folder or see the whole project structure. NO MORE SEARCHING your codebase. File and folder names and nesting reveal to claude a lot of logic and flow. This becomes like a super power for claude.
- Any file can be included in the pre loaded context. The two other defaults are the CLAUDE.md and WORKSPACE.md files.
- The CLAUDE.md file gives claude an understanding of the current workspace purpose and any branch relevant discoveries that need remembering, this stops the bloating of the project level claude.md file and allows for surgical memories (eg switch branches --> switch relevant memories).
- The WORKSPACE.md file guides claude on the logistical requirements of the branch. One branch might be a multiphase feature, another might be a quick fix. Through this file, Claude now knows this and other important requirements (like attached git issues, merge ).
- The injected context is silent, so it doesn't clog up the chat, it doesn't appear in any history files either. However, a system message is inlined in the chat, so that you can confirm context has been added.

`tree.md` example

```md
â”œâ”€â”€ dev
â”‚ â”œâ”€â”€ branches
â”‚ â””â”€â”€ workspace
â”‚ â”œâ”€â”€ context
â”‚ â”‚ â””â”€â”€ tree.md
â”‚ â”œâ”€â”€ research
â”‚ â”œâ”€â”€ reviews
â”‚ â”œâ”€â”€ tasks
â”‚ â”‚ â””â”€â”€ assistant
â”‚ â”œâ”€â”€ CLAUDE.md
â”‚ â”œâ”€â”€ README.md
â”‚ â””â”€â”€ WORKSPACE.md
```

### User_prompt_submit Triggers

Back when sonnet 3.5 was the "world's greatest coding model", I invented an advanced context shaping system using styles. Each style would produce a specific structured output that would significantly improve the quality of the context.

Here is my reddit post about it that was pinned by the mods...
https://www.reddit.com/r/ClaudeAI/comments/1i4c6jx/my_guide_to_using_styles_effectively

So over a year later, these "styles" can still be used per turn in claude code just as effectively, but it is now way easier using a user_prompt_submit hook. I simply use a trigger statement and bam! Claude's output is instantly different...

- Uses unique trigger statements directly in the user's prompt to shape Claude's next response. Thoughtfully they should not trigger during general conversation.
- Each trigger-injected style or output uses a template file. These can be edited without touching the hook's code files, allowing you to iterate the "style" if needed.
- More triggers can be easily added by copying the existing hook files and logic. The only changes required are the naming, the trigger statements and the output template. A slight adjustment of the log and system message output can also be made.
- Logs the hook in the users (global) .claude and shows a system message to the user in the chat to indicate that a trigger fired.

Here are some of the triggers and styles produced...

- **Show working** - Is still my all time favorite. Claude reflects back his understanding of your task, all his ideas for completing the task, any issues he might come across and where in the project he expects the changes to happen and what format it will take. This is gold for catching any misunderstandings, adjusting any task parameters before starting, addressing issues etc. It also is the best prompt improver ever, as claude has just restated your initial prompt but usually improved it A LOT. This is then snapshotted into the chat stream so that he works from the improved prompt, not your crappy mind dump.
- **Claude Space** - An alternative to "thinking" which claude does on a turn-by-turn basis, except this is "session" thinking. As effective as thinking for improving context, claude is given a "space" to think out loud about the WHOLE conversation so far. He becomes really candid and produces thoughts applicable to the chat that would never normally be surfaced. Once again, this is then permanently on record in the chat for further discussion or reference.
- **Show options** - Gets claude thinking about different options for completing the task. This then produces output that wouldn't normally surface, whereby he is asked to either recommend a new option, stay with original or cherry-pick to combine.
- **Show strategy** - Much like show working, forces claude to reveal HOW (his process, not his changes) he is going to complete the task. provide other strategy options and reveal any difficulties he may encounter. This enables user intervention and leaves a strategy record in the chat that claude will now follow more vigorously. Trigger this one during planning after he has a decent idea of what the task involves.
- **Show context** - Pop this to get claude to inject all the places he intends on finding context for his task. This get him thinking about WHERE to find context far more effectively. Also intervention and guidance opportunities arise.
- **Show difficulties** - Claude analyses the chat and reveals if he and the user are having any communication difficulties. If any, the chat will be left with a record of the difficulties, making it far more likely for him to stop "misbehaving". Also his reply can be added to CLAUDE.md if significant enough to provide the guard rail on a broader scope.

These can produce conversations rich in shaped context without pre placing guard and guide rails everywhere (output-styles, CLAUDE.md, commands etc).

Just a simple warning. Use only one trigger statement per turn, claude will get confused otherwise.

### Branches archive

Once your branch is finished. Very simple automation can archive all the workspace context into a separate auto-named `dev/branch/{name}` directory. This creates an amazing record and history over time of how you built your project. Each branch archive containing all the relevant workspace context and files produced while on that branch.

Branch archiving also allows you to work on multiple branches at once using only branch relevant context, all the other branch's workspace context isn't getting in the way for claude to stumble over. If you need to use some workspace context on another branch, archive it early (you can overwrite it later) then access that context through the branch archive.

An even bigger level up is A/B building features in parallel. Create a branch for vibe code and a branch for step by step guided development for the same feature. merge the winner, cherry-pick between them using the archived filebox directory.

## Blank Slate

Finally, this workspace system is not a workflow. It is a toolset, infinitely able to accommodate any Claude Code workflow. Use what you want, leave out what you don't, customise what gets shown to Claude. 

This workspace deliberately avoids implementing any skills, agents, output-styles, mcp servers, these are all up to you. But it also doesn't really need those tools either to be effective. Everybody loves efficient token usage and preserving usage limits all session and week, while providing key usable context right???

What dev workspace will do is enhance and enable your workflow to operate much better, probably even enabling trimming your workflow down as the workspace tools provide a lot of the core context. You will also have a place to store all the files and planning that your workflow creates, but it will be clean and organised.  

Also don't be surprised if your velocity increases. Using one instance, with repeated exiting and starting new conversations well before compaction hits, keeping you in the <100k token butter zone, (Claude's quality drops when the chat fills up).
